name: Publica√ß√£o Autom√°tica de Loterias (Portal SimonSports)

on:
  schedule:
    # Executa a cada 10 minutos
    - cron: "*/10 * * * *"
  workflow_dispatch: # Permite execu√ß√£o manual tamb√©m

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      # 1Ô∏è‚É£ Clona o reposit√≥rio
      - name: Checkout do reposit√≥rio
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Instala depend√™ncias do Python
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Instalar depend√™ncias
        run: |
          python -m pip install --upgrade pip
          pip install gspread oauth2client tweepy requests pytz python-dotenv Pillow flask

      # 3Ô∏è‚É£ Executa o bot
      - name: Executar o bot (ciclo √∫nico)
        env:
          # === OBRIGAT√ìRIOS ===
          GOOGLE_SHEET_ID: "16NcdSwX6q_EQ2XjS1KNIBe6C3Piq-lCBgA38TMszXCI"
          GOOGLE_SERVICE_JSON: ${{ secrets.GOOGLE_SERVICE_JSON }}

          # === CONTAS X (Twitter) ===
          TWITTER_API_KEY_1: ${{ secrets.TWITTER_API_KEY_1 }}
          TWITTER_API_SECRET_1: ${{ secrets.TWITTER_API_SECRET_1 }}
          TWITTER_ACCESS_TOKEN_1: ${{ secrets.TWITTER_ACCESS_TOKEN_1 }}
          TWITTER_ACCESS_SECRET_1: ${{ secrets.TWITTER_ACCESS_SECRET_1 }}

          TWITTER_API_KEY_2: ${{ secrets.TWITTER_API_KEY_2 }}
          TWITTER_API_SECRET_2: ${{ secrets.TWITTER_API_SECRET_2 }}
          TWITTER_ACCESS_TOKEN_2: ${{ secrets.TWITTER_ACCESS_TOKEN_2 }}
          TWITTER_ACCESS_SECRET_2: ${{ secrets.TWITTER_ACCESS_SECRET_2 }}

          # === REDE E COMPORTAMENTO ===
          TARGET_NETWORK: "X"
          BACKLOG_DAYS: "2"
          MAX_PUBLICACOES_RODADA: "30"
          PAUSA_ENTRE_POSTS: "3"
          DRY_RUN: "false"

          # === THREAD E IMAGEM ===
          THREAD_MODE: "true"               # publica 2 tweets (titulo+imagem e depois detalhes)
          POST_X_WITH_IMAGE: "true"         # usa imagem da coluna 6 ou 7
          TELEGRAM_CANAL_1: "https://t.me/portalsimonsportsdicasesportivas"
          TELEGRAM_CANAL_2: "https://t.me/portalsimonsports"

          # === OUTRAS REDES (reservado/futuro) ===
          DISCORD_WEBHOOK_URL: ""
          PINTEREST_ACCESS_TOKEN: ""
          PINTEREST_BOARD_ID: ""
          FB_PAGE_ID: ""
          FB_PAGE_ACCESS_TOKEN: ""

          # === MODO KEEPALIVE (Render/Replit) ===
          ENABLE_KEEPALIVE: "true"
          KEEPALIVE_PORT: "8080"

        run: |
          echo "üöÄ Iniciando publica√ß√£o autom√°tica no X (modo thread + imagem)"
          python bot.py

      # 4Ô∏è‚É£ Logs
      - name: Exibir logs finais
        if: always()
        run: |
          echo "‚úÖ Execu√ß√£o conclu√≠da ‚Äî $(date '+%d/%m/%Y %H:%M:%S')"
